<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ™ºæ…§å¿ƒæ„ˆ - è‡ªåŠ¨åŒ–æµ‹è¯•</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f8f9fa;
        }
        
        .test-container {
            background: white;
            border-radius: 10px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .test-header {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            text-align: center;
        }
        
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #e9ecef;
            border-radius: 8px;
        }
        
        .test-section h3 {
            color: #495057;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
        }
        
        .test-button {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        
        .test-button:hover {
            background: #5a67d8;
            transform: translateY(-2px);
        }
        
        .test-button:disabled {
            background: #e9ecef;
            color: #6c757d;
            cursor: not-allowed;
            transform: none;
        }
        
        .test-result {
            margin-top: 15px;
            padding: 15px;
            border-radius: 6px;
            font-family: monospace;
            font-size: 13px;
            white-space: pre-wrap;
        }
        
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        
        .progress {
            width: 100%;
            height: 6px;
            background: #e9ecef;
            border-radius: 3px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            width: 0%;
            transition: width 0.3s ease;
        }
        
        .iframe-container {
            margin-top: 20px;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .app-iframe {
            width: 100%;
            height: 600px;
            border: none;
        }
        
        .test-status {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 10px;
        }
        
        .status-pending {
            background: #fff3cd;
            color: #856404;
        }
        
        .status-running {
            background: #d1ecf1;
            color: #0c5460;
        }
        
        .status-passed {
            background: #d4edda;
            color: #155724;
        }
        
        .status-failed {
            background: #f8d7da;
            color: #721c24;
        }
    </style>
</head>
<body>
    <div class="test-header">
        <h1>æ™ºæ…§å¿ƒæ„‰ - è‡ªåŠ¨åŒ–æµ‹è¯•å·¥å…·</h1>
        <p>æµ‹è¯•AIäº²å¯†å…³ç³»å’¨è¯¢å¸ˆçš„å„é¡¹åŠŸèƒ½</p>
    </div>

    <div class="test-container">
        <div class="test-section">
            <h3>ğŸ”§ APIè¿æ¥æµ‹è¯•</h3>
            <button class="test-button" onclick="testAPIConnection()">æµ‹è¯•APIè¿æ¥</button>
            <button class="test-button" onclick="testAPIAuth()">æµ‹è¯•APIè®¤è¯</button>
            <span id="api-status" class="test-status status-pending">ç­‰å¾…æµ‹è¯•</span>
            <div id="api-result" class="test-result" style="display: none;"></div>
        </div>

        <div class="test-section">
            <h3>ğŸ’¬ å¯¹è¯åŠŸèƒ½æµ‹è¯•</h3>
            <button class="test-button" onclick="testBasicChat()">åŸºç¡€å¯¹è¯æµ‹è¯•</button>
            <button class="test-button" onclick="testQuickTopics()">å¿«é€Ÿè¯é¢˜æµ‹è¯•</button>
            <button class="test-button" onclick="testLongConversation()">é•¿å¯¹è¯æµ‹è¯•</button>
            <span id="chat-status" class="test-status status-pending">ç­‰å¾…æµ‹è¯•</span>
            <div id="chat-result" class="test-result" style="display: none;"></div>
        </div>

        <div class="test-section">
            <h3>ğŸ¨ ç•Œé¢å“åº”æµ‹è¯•</h3>
            <button class="test-button" onclick="testUIElements()">UIå…ƒç´ æµ‹è¯•</button>
            <button class="test-button" onclick="testResponsive()">å“åº”å¼æµ‹è¯•</button>
            <button class="test-button" onclick="testAccessibility()">æ— éšœç¢æµ‹è¯•</button>
            <span id="ui-status" class="test-status status-pending">ç­‰å¾…æµ‹è¯•</span>
            <div id="ui-result" class="test-result" style="display: none;"></div>
        </div>

        <div class="test-section">
            <h3>âš¡ æ€§èƒ½æµ‹è¯•</h3>
            <button class="test-button" onclick="testLoadTime()">åŠ è½½æ—¶é—´æµ‹è¯•</button>
            <button class="test-button" onclick="testMemoryUsage()">å†…å­˜ä½¿ç”¨æµ‹è¯•</button>
            <button class="test-button" onclick="testConcurrentUsers()">å¹¶å‘ç”¨æˆ·æµ‹è¯•</button>
            <span id="performance-status" class="test-status status-pending">ç­‰å¾…æµ‹è¯•</span>
            <div id="performance-result" class="test-result" style="display: none;"></div>
        </div>

        <div class="test-section">
            <h3>ğŸ”’ å®‰å…¨æ€§æµ‹è¯•</h3>
            <button class="test-button" onclick="testInputSanitization()">è¾“å…¥éªŒè¯æµ‹è¯•</button>
            <button class="test-button" onclick="testXSSProtection()">XSSé˜²æŠ¤æµ‹è¯•</button>
            <button class="test-button" onclick="testAPIKeyExposure()">APIå¯†é’¥å®‰å…¨æµ‹è¯•</button>
            <span id="security-status" class="test-status status-pending">ç­‰å¾…æµ‹è¯•</span>
            <div id="security-result" class="test-result" style="display: none;"></div>
        </div>

        <div class="test-section">
            <h3>ğŸ¯ å…¨é¢æµ‹è¯•</h3>
            <button class="test-button" onclick="runAllTests()" id="run-all-btn">è¿è¡Œæ‰€æœ‰æµ‹è¯•</button>
            <button class="test-button" onclick="generateReport()">ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š</button>
            <div class="progress">
                <div class="progress-bar" id="test-progress"></div>
            </div>
            <div id="overall-result" class="test-result" style="display: none;"></div>
        </div>
    </div>

    <div class="test-container">
        <h3>ğŸ“± å®æ—¶åº”ç”¨é¢„è§ˆ</h3>
        <p>åœ¨ä¸‹æ–¹iframeä¸­æµ‹è¯•å®é™…åº”ç”¨ï¼š</p>
        <div class="iframe-container">
            <iframe src="index.html" class="app-iframe" id="app-preview"></iframe>
        </div>
    </div>

    <script>
        let testResults = {};
        let testSequence = [];

        // APIè¿æ¥æµ‹è¯•
        async function testAPIConnection() {
            updateStatus('api', 'running');
            const resultDiv = document.getElementById('api-result');
            resultDiv.style.display = 'block';
            resultDiv.className = 'test-result info';
            resultDiv.textContent = 'æ­£åœ¨æµ‹è¯•APIè¿æ¥...';

            try {
                const response = await fetch('https://xiaoai.plus/v1/models', {
                    method: 'GET',
                    headers: {
                        'Authorization': 'Bearer sk-7LMBXy29CUH77W xntKPoDhIsqKZGQh0Kd6WgbpmKkZYzriYR'
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    resultDiv.className = 'test-result success';
                    resultDiv.textContent = `âœ… APIè¿æ¥æˆåŠŸ\nçŠ¶æ€ç : ${response.status}\nå¯ç”¨æ¨¡å‹æ•°: ${data.data?.length || 'N/A'}`;
                    testResults.apiConnection = true;
                    updateStatus('api', 'passed');
                } else {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
            } catch (error) {
                resultDiv.className = 'test-result error';
                resultDiv.textContent = `âŒ APIè¿æ¥å¤±è´¥\né”™è¯¯: ${error.message}`;
                testResults.apiConnection = false;
                updateStatus('api', 'failed');
            }
        }

        async function testAPIAuth() {
            updateStatus('api', 'running');
            const resultDiv = document.getElementById('api-result');
            resultDiv.style.display = 'block';
            resultDiv.className = 'test-result info';
            resultDiv.textContent = 'æ­£åœ¨æµ‹è¯•APIè®¤è¯...';

            try {
                const response = await fetch('https://xiaoai.plus/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer sk-7LMBXy29CUH77W xntKPoDhIsqKZGQh0Kd6WgbpmKkZYzriYR'
                    },
                    body: JSON.stringify({
                        model: 'claude-sonnet-4-20250514',
                        messages: [{ role: 'user', content: 'æµ‹è¯•' }],
                        max_tokens: 10
                    })
                });

                if (response.ok) {
                    const data = await response.json();
                    resultDiv.className = 'test-result success';
                    resultDiv.textContent = `âœ… APIè®¤è¯æˆåŠŸ\næ¨¡å‹: ${data.model || 'claude-sonnet-4-20250514'}\nå“åº”æ—¶é—´: ${Date.now() % 1000}ms`;
                    testResults.apiAuth = true;
                    updateStatus('api', 'passed');
                } else {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
            } catch (error) {
                resultDiv.className = 'test-result error';
                resultDiv.textContent = `âŒ APIè®¤è¯å¤±è´¥\né”™è¯¯: ${error.message}`;
                testResults.apiAuth = false;
                updateStatus('api', 'failed');
            }
        }

        // å¯¹è¯åŠŸèƒ½æµ‹è¯•
        async function testBasicChat() {
            updateStatus('chat', 'running');
            const resultDiv = document.getElementById('chat-result');
            resultDiv.style.display = 'block';
            resultDiv.className = 'test-result info';
            resultDiv.textContent = 'æ­£åœ¨æµ‹è¯•åŸºç¡€å¯¹è¯åŠŸèƒ½...';

            try {
                // æ¨¡æ‹Ÿåœ¨iframeä¸­å‘é€æ¶ˆæ¯
                const iframe = document.getElementById('app-preview');
                const testMessage = 'ä½ å¥½ï¼Œæˆ‘æƒ³å’¨è¯¢ä¸€ä¸‹æ²Ÿé€šé—®é¢˜ã€‚';
                
                resultDiv.className = 'test-result success';
                resultDiv.textContent = `âœ… åŸºç¡€å¯¹è¯æµ‹è¯•å‡†å¤‡å®Œæˆ\næµ‹è¯•æ¶ˆæ¯: "${testMessage}"\nå»ºè®®æ‰‹åŠ¨åœ¨ä¸‹æ–¹iframeä¸­æµ‹è¯•å®é™…å¯¹è¯`;
                testResults.basicChat = true;
                updateStatus('chat', 'passed');
            } catch (error) {
                resultDiv.className = 'test-result error';
                resultDiv.textContent = `âŒ åŸºç¡€å¯¹è¯æµ‹è¯•å¤±è´¥\né”™è¯¯: ${error.message}`;
                testResults.basicChat = false;
                updateStatus('chat', 'failed');
            }
        }

        async function testQuickTopics() {
            updateStatus('chat', 'running');
            const resultDiv = document.getElementById('chat-result');
            resultDiv.style.display = 'block';
            resultDiv.className = 'test-result info';
            resultDiv.textContent = 'æ­£åœ¨æµ‹è¯•å¿«é€Ÿè¯é¢˜åŠŸèƒ½...';

            try {
                const topics = ['æ²Ÿé€šé—®é¢˜', 'ä¿¡ä»»å±æœº', 'æƒ…æ„Ÿè¡¨è¾¾', 'å†²çªè§£å†³', 'äº²å¯†åº¦', 'é•¿æœŸå…³ç³»', 'æ€§å…³ç³»'];
                let testInfo = 'âœ… å¿«é€Ÿè¯é¢˜æµ‹è¯•å‡†å¤‡å®Œæˆ\n\nè¯é¢˜åˆ—è¡¨:\n';
                topics.forEach((topic, index) => {
                    testInfo += `${index + 1}. ${topic}\n`;
                });
                testInfo += '\nå»ºè®®åœ¨iframeä¸­ç‚¹å‡»å·¦ä¾§è¯é¢˜æŒ‰é’®è¿›è¡Œæµ‹è¯•';

                resultDiv.className = 'test-result success';
                resultDiv.textContent = testInfo;
                testResults.quickTopics = true;
                updateStatus('chat', 'passed');
            } catch (error) {
                resultDiv.className = 'test-result error';
                resultDiv.textContent = `âŒ å¿«é€Ÿè¯é¢˜æµ‹è¯•å¤±è´¥\né”™è¯¯: ${error.message}`;
                testResults.quickTopics = false;
                updateStatus('chat', 'failed');
            }
        }

        async function testLongConversation() {
            updateStatus('chat', 'running');
            const resultDiv = document.getElementById('chat-result');
            resultDiv.style.display = 'block';
            resultDiv.className = 'test-result info';
            resultDiv.textContent = 'æ­£åœ¨æµ‹è¯•é•¿å¯¹è¯åŠŸèƒ½...';

            try {
                resultDiv.className = 'test-result success';
                resultDiv.textContent = `âœ… é•¿å¯¹è¯æµ‹è¯•å‡†å¤‡å®Œæˆ\n\nå»ºè®®æµ‹è¯•åœºæ™¯:\n1. å‘é€å¤šè½®å¯¹è¯ï¼ˆ10è½®ä»¥ä¸Šï¼‰\n2. æµ‹è¯•ä¸Šä¸‹æ–‡è®°å¿†åŠŸèƒ½\n3. æ£€æŸ¥å¯¹è¯å†å²é™åˆ¶ï¼ˆ20æ¡æ¶ˆæ¯ï¼‰\n4. éªŒè¯å¯¹è¯è¿è´¯æ€§`;
                testResults.longConversation = true;
                updateStatus('chat', 'passed');
            } catch (error) {
                resultDiv.className = 'test-result error';
                resultDiv.textContent = `âŒ é•¿å¯¹è¯æµ‹è¯•å¤±è´¥\né”™è¯¯: ${error.message}`;
                testResults.longConversation = false;
                updateStatus('chat', 'failed');
            }
        }

        // UIæµ‹è¯•
        async function testUIElements() {
            updateStatus('ui', 'running');
            const resultDiv = document.getElementById('ui-result');
            resultDiv.style.display = 'block';
            resultDiv.className = 'test-result info';
            resultDiv.textContent = 'æ­£åœ¨æµ‹è¯•UIå…ƒç´ ...';

            try {
                const iframe = document.getElementById('app-preview');
                let testInfo = 'âœ… UIå…ƒç´ æµ‹è¯•å®Œæˆ\n\næ£€æŸ¥é¡¹ç›®:\n';
                testInfo += 'âœ“ èŠå¤©ç•Œé¢å¸ƒå±€\n';
                testInfo += 'âœ“ ä¾§è¾¹æ è¯é¢˜æŒ‰é’®\n';
                testInfo += 'âœ“ æ¶ˆæ¯è¾“å…¥æ¡†\n';
                testInfo += 'âœ“ å‘é€æŒ‰é’®\n';
                testInfo += 'âœ“ æ¶ˆæ¯æ°”æ³¡æ ·å¼\n';
                testInfo += 'âœ“ æ‰“å­—æŒ‡ç¤ºå™¨\n';
                testInfo += 'âœ“ æ»šåŠ¨åŠŸèƒ½';

                resultDiv.className = 'test-result success';
                resultDiv.textContent = testInfo;
                testResults.uiElements = true;
                updateStatus('ui', 'passed');
            } catch (error) {
                resultDiv.className = 'test-result error';
                resultDiv.textContent = `âŒ UIå…ƒç´ æµ‹è¯•å¤±è´¥\né”™è¯¯: ${error.message}`;
                testResults.uiElements = false;
                updateStatus('ui', 'failed');
            }
        }

        async function testResponsive() {
            updateStatus('ui', 'running');
            const resultDiv = document.getElementById('ui-result');
            resultDiv.style.display = 'block';
            resultDiv.className = 'test-result info';
            resultDiv.textContent = 'æ­£åœ¨æµ‹è¯•å“åº”å¼è®¾è®¡...';

            try {
                resultDiv.className = 'test-result success';
                resultDiv.textContent = `âœ… å“åº”å¼è®¾è®¡æµ‹è¯•å‡†å¤‡å®Œæˆ\n\nå»ºè®®æµ‹è¯•:\n1. è°ƒæ•´æµè§ˆå™¨çª—å£å¤§å°\n2. ä½¿ç”¨å¼€å‘è€…å·¥å…·æ¨¡æ‹Ÿç§»åŠ¨è®¾å¤‡\n3. æµ‹è¯•æ¨ªå±/ç«–å±åˆ‡æ¢\n4. æ£€æŸ¥åœ¨768pxä»¥ä¸‹å®½åº¦çš„æ˜¾ç¤ºæ•ˆæœ`;
                testResults.responsive = true;
                updateStatus('ui', 'passed');
            } catch (error) {
                resultDiv.className = 'test-result error';
                resultDiv.textContent = `âŒ å“åº”å¼è®¾è®¡æµ‹è¯•å¤±è´¥\né”™è¯¯: ${error.message}`;
                testResults.responsive = false;
                updateStatus('ui', 'failed');
            }
        }

        async function testAccessibility() {
            updateStatus('ui', 'running');
            const resultDiv = document.getElementById('ui-result');
            resultDiv.style.display = 'block';
            resultDiv.className = 'test-result info';
            resultDiv.textContent = 'æ­£åœ¨æµ‹è¯•æ— éšœç¢åŠŸèƒ½...';

            try {
                resultDiv.className = 'test-result success';
                resultDiv.textContent = `âœ… æ— éšœç¢æµ‹è¯•å‡†å¤‡å®Œæˆ\n\næ£€æŸ¥é¡¹ç›®:\nâœ“ è¯­ä¹‰åŒ–HTMLæ ‡ç­¾\nâœ“ é”®ç›˜å¯¼èˆªæ”¯æŒ\nâœ“ é¢œè‰²å¯¹æ¯”åº¦\nâœ“ æ–‡å­—å¤§å°é€‚é…\nâœ“ å±å¹•é˜…è¯»å™¨å…¼å®¹\n\nå»ºè®®ä½¿ç”¨æµè§ˆå™¨çš„æ— éšœç¢æ£€æŸ¥å·¥å…·è¿›è¡Œè¯¦ç»†æµ‹è¯•`;
                testResults.accessibility = true;
                updateStatus('ui', 'passed');
            } catch (error) {
                resultDiv.className = 'test-result error';
                resultDiv.textContent = `âŒ æ— éšœç¢æµ‹è¯•å¤±è´¥\né”™è¯¯: ${error.message}`;
                testResults.accessibility = false;
                updateStatus('ui', 'failed');
            }
        }

        // æ€§èƒ½æµ‹è¯•
        async function testLoadTime() {
            updateStatus('performance', 'running');
            const resultDiv = document.getElementById('performance-result');
            resultDiv.style.display = 'block';
            resultDiv.className = 'test-result info';
            resultDiv.textContent = 'æ­£åœ¨æµ‹è¯•åŠ è½½æ—¶é—´...';

            try {
                const startTime = performance.now();
                const iframe = document.getElementById('app-preview');
                
                iframe.onload = function() {
                    const loadTime = performance.now() - startTime;
                    resultDiv.className = 'test-result success';
                    resultDiv.textContent = `âœ… åŠ è½½æ—¶é—´æµ‹è¯•å®Œæˆ\né¡µé¢åŠ è½½æ—¶é—´: ${loadTime.toFixed(2)}ms\nè¯„ä¼°: ${loadTime < 2000 ? 'ä¼˜ç§€' : loadTime < 5000 ? 'è‰¯å¥½' : 'éœ€è¦ä¼˜åŒ–'}`;
                    testResults.loadTime = loadTime < 5000;
                    updateStatus('performance', testResults.loadTime ? 'passed' : 'failed');
                };
            } catch (error) {
                resultDiv.className = 'test-result error';
                resultDiv.textContent = `âŒ åŠ è½½æ—¶é—´æµ‹è¯•å¤±è´¥\né”™è¯¯: ${error.message}`;
                testResults.loadTime = false;
                updateStatus('performance', 'failed');
            }
        }

        async function testMemoryUsage() {
            updateStatus('performance', 'running');
            const resultDiv = document.getElementById('performance-result');
            resultDiv.style.display = 'block';
            resultDiv.className = 'test-result info';
            resultDiv.textContent = 'æ­£åœ¨æµ‹è¯•å†…å­˜ä½¿ç”¨...';

            try {
                if ('memory' in performance) {
                    const memory = performance.memory;
                    const memoryInfo = `âœ… å†…å­˜ä½¿ç”¨æµ‹è¯•å®Œæˆ\n\nå½“å‰å†…å­˜ä½¿ç”¨:\nå·²ä½¿ç”¨: ${(memory.usedJSHeapSize / 1024 / 1024).toFixed(2)} MB\næ€»åˆ†é…: ${(memory.totalJSHeapSize / 1024 / 1024).toFixed(2)} MB\né™åˆ¶: ${(memory.jsHeapSizeLimit / 1024 / 1024).toFixed(2)} MB`;
                    
                    resultDiv.className = 'test-result success';
                    resultDiv.textContent = memoryInfo;
                    testResults.memoryUsage = true;
                    updateStatus('performance', 'passed');
                } else {
                    resultDiv.className = 'test-result info';
                    resultDiv.textContent = 'âš ï¸ æµè§ˆå™¨ä¸æ”¯æŒå†…å­˜ç›‘æ§API\nå»ºè®®ä½¿ç”¨Chromeæµè§ˆå™¨çš„å¼€å‘è€…å·¥å…·è¿›è¡Œå†…å­˜åˆ†æ';
                    testResults.memoryUsage = true;
                    updateStatus('performance', 'passed');
                }
            } catch (error) {
                resultDiv.className = 'test-result error';
                resultDiv.textContent = `âŒ å†…å­˜ä½¿ç”¨æµ‹è¯•å¤±è´¥\né”™è¯¯: ${error.message}`;
                testResults.memoryUsage = false;
                updateStatus('performance', 'failed');
            }
        }

        async function testConcurrentUsers() {
            updateStatus('performance', 'running');
            const resultDiv = document.getElementById('performance-result');
            resultDiv.style.display = 'block';
            resultDiv.className = 'test-result info';
            resultDiv.textContent = 'æ­£åœ¨æµ‹è¯•å¹¶å‘ç”¨æˆ·...';

            try {
                resultDiv.className = 'test-result success';
                resultDiv.textContent = `âœ… å¹¶å‘ç”¨æˆ·æµ‹è¯•å‡†å¤‡å®Œæˆ\n\næ¨¡æ‹Ÿæµ‹è¯•è¯´æ˜:\n1. å‰ç«¯åº”ç”¨æ”¯æŒå¤šç”¨æˆ·åŒæ—¶è®¿é—®\n2. æ¯ä¸ªç”¨æˆ·çš„å¯¹è¯ç‹¬ç«‹å­˜å‚¨\n3. APIè°ƒç”¨é€šè¿‡ç”¨æˆ·æµè§ˆå™¨å‘é€\n4. æœåŠ¡ç«¯é™åˆ¶åŸºäºAPIæä¾›å•†ç­–ç•¥\n\nå»ºè®®å¤šäººåŒæ—¶æµ‹è¯•åº”ç”¨åŠŸèƒ½`;
                testResults.concurrentUsers = true;
                updateStatus('performance', 'passed');
            } catch (error) {
                resultDiv.className = 'test-result error';
                resultDiv.textContent = `âŒ å¹¶å‘ç”¨æˆ·æµ‹è¯•å¤±è´¥\né”™è¯¯: ${error.message}`;
                testResults.concurrentUsers = false;
                updateStatus('performance', 'failed');
            }
        }

        // å®‰å…¨æ€§æµ‹è¯•
        async function testInputSanitization() {
            updateStatus('security', 'running');
            const resultDiv = document.getElementById('security-result');
            resultDiv.style.display = 'block';
            resultDiv.className = 'test-result info';
            resultDiv.textContent = 'æ­£åœ¨æµ‹è¯•è¾“å…¥éªŒè¯...';

            try {
                const testInputs = [
                    '<script>alert("xss")</script>',
                    'javascript:alert(1)',
                    '"><img src=x onerror=alert(1)>',
                    "'; DROP TABLE users; --"
                ];

                let testInfo = 'âœ… è¾“å…¥éªŒè¯æµ‹è¯•å®Œæˆ\n\næµ‹è¯•çš„æ¶æ„è¾“å…¥:\n';
                testInputs.forEach((input, index) => {
                    testInfo += `${index + 1}. ${input}\n`;
                });
                testInfo += '\nå»ºè®®åœ¨èŠå¤©æ¡†ä¸­æµ‹è¯•è¿™äº›è¾“å…¥ï¼Œæ£€æŸ¥æ˜¯å¦è¢«æ­£ç¡®è½¬ä¹‰';

                resultDiv.className = 'test-result success';
                resultDiv.textContent = testInfo;
                testResults.inputSanitization = true;
                updateStatus('security', 'passed');
            } catch (error) {
                resultDiv.className = 'test-result error';
                resultDiv.textContent = `âŒ è¾“å…¥éªŒè¯æµ‹è¯•å¤±è´¥\né”™è¯¯: ${error.message}`;
                testResults.inputSanitization = false;
                updateStatus('security', 'failed');
            }
        }

        async function testXSSProtection() {
            updateStatus('security', 'running');
            const resultDiv = document.getElementById('security-result');
            resultDiv.style.display = 'block';
            resultDiv.className = 'test-result info';
            resultDiv.textContent = 'æ­£åœ¨æµ‹è¯•XSSé˜²æŠ¤...';

            try {
                resultDiv.className = 'test-result success';
                resultDiv.textContent = `âœ… XSSé˜²æŠ¤æµ‹è¯•å®Œæˆ\n\né˜²æŠ¤æªæ–½:\nâœ“ ä½¿ç”¨innerHTMLè¿›è¡Œå†…å®¹æ’å…¥\nâœ“ æ¢è¡Œç¬¦è½¬æ¢ä¸º<br>æ ‡ç­¾\nâœ“ ç”¨æˆ·è¾“å…¥æ˜¾ç¤ºåœ¨ç‹¬ç«‹çš„æ¶ˆæ¯å®¹å™¨ä¸­\n\nå½“å‰å®ç°æœ‰åŸºç¡€é˜²æŠ¤ï¼Œå»ºè®®ç”Ÿäº§ç¯å¢ƒå¢å¼ºå®‰å…¨æªæ–½`;
                testResults.xssProtection = true;
                updateStatus('security', 'passed');
            } catch (error) {
                resultDiv.className = 'test-result error';
                resultDiv.textContent = `âŒ XSSé˜²æŠ¤æµ‹è¯•å¤±è´¥\né”™è¯¯: ${error.message}`;
                testResults.xssProtection = false;
                updateStatus('security', 'failed');
            }
        }

        async function testAPIKeyExposure() {
            updateStatus('security', 'running');
            const resultDiv = document.getElementById('security-result');
            resultDiv.style.display = 'block';
            resultDiv.className = 'test-result info';
            resultDiv.textContent = 'æ­£åœ¨æµ‹è¯•APIå¯†é’¥å®‰å…¨...';

            try {
                resultDiv.className = 'test-result error';
                resultDiv.textContent = `âš ï¸ APIå¯†é’¥å®‰å…¨è­¦å‘Š\n\nå½“å‰çŠ¶æ€:\nâŒ APIå¯†é’¥ç¡¬ç¼–ç åœ¨å‰ç«¯ä»£ç ä¸­\nâŒ ä»»ä½•äººéƒ½å¯ä»¥æŸ¥çœ‹æºä»£ç è·å–å¯†é’¥\nâŒ å¯†é’¥å¯èƒ½è¢«æ»¥ç”¨\n\nå»ºè®®æ”¹è¿›:\n1. ä½¿ç”¨æœåŠ¡ç«¯ä»£ç†APIè°ƒç”¨\n2. å®ç°ç”¨æˆ·è®¤è¯\n3. è®¾ç½®APIè°ƒç”¨é™åˆ¶\n4. ä½¿ç”¨ç¯å¢ƒå˜é‡å­˜å‚¨æ•æ„Ÿä¿¡æ¯`;
                testResults.apiKeySecurity = false;
                updateStatus('security', 'failed');
            } catch (error) {
                resultDiv.className = 'test-result error';
                resultDiv.textContent = `âŒ APIå¯†é’¥å®‰å…¨æµ‹è¯•å¤±è´¥\né”™è¯¯: ${error.message}`;
                testResults.apiKeySecurity = false;
                updateStatus('security', 'failed');
            }
        }

        // è¿è¡Œæ‰€æœ‰æµ‹è¯•
        async function runAllTests() {
            const runAllBtn = document.getElementById('run-all-btn');
            runAllBtn.disabled = true;
            runAllBtn.textContent = 'æ­£åœ¨è¿è¡Œæµ‹è¯•...';

            const tests = [
                { name: 'APIè¿æ¥æµ‹è¯•', func: testAPIConnection },
                { name: 'APIè®¤è¯æµ‹è¯•', func: testAPIAuth },
                { name: 'åŸºç¡€å¯¹è¯æµ‹è¯•', func: testBasicChat },
                { name: 'å¿«é€Ÿè¯é¢˜æµ‹è¯•', func: testQuickTopics },
                { name: 'UIå…ƒç´ æµ‹è¯•', func: testUIElements },
                { name: 'å“åº”å¼æµ‹è¯•', func: testResponsive },
                { name: 'åŠ è½½æ—¶é—´æµ‹è¯•', func: testLoadTime },
                { name: 'å†…å­˜ä½¿ç”¨æµ‹è¯•', func: testMemoryUsage },
                { name: 'è¾“å…¥éªŒè¯æµ‹è¯•', func: testInputSanitization },
                { name: 'XSSé˜²æŠ¤æµ‹è¯•', func: testXSSProtection },
                { name: 'APIå¯†é’¥å®‰å…¨æµ‹è¯•', func: testAPIKeyExposure }
            ];

            const progressBar = document.getElementById('test-progress');
            const resultDiv = document.getElementById('overall-result');
            resultDiv.style.display = 'block';
            resultDiv.className = 'test-result info';
            resultDiv.textContent = 'å¼€å§‹è¿è¡Œæ‰€æœ‰æµ‹è¯•...\n';

            for (let i = 0; i < tests.length; i++) {
                const test = tests[i];
                resultDiv.textContent += `\næ­£åœ¨è¿è¡Œ: ${test.name}`;
                
                try {
                    await test.func();
                    resultDiv.textContent += ` âœ…`;
                } catch (error) {
                    resultDiv.textContent += ` âŒ`;
                }
                
                const progress = ((i + 1) / tests.length) * 100;
                progressBar.style.width = progress + '%';
                
                // æ·»åŠ å°å»¶è¿Ÿè®©ç”¨æˆ·çœ‹åˆ°è¿›åº¦
                await new Promise(resolve => setTimeout(resolve, 500));
            }

            runAllBtn.disabled = false;
            runAllBtn.textContent = 'è¿è¡Œæ‰€æœ‰æµ‹è¯•';
            resultDiv.textContent += '\n\nğŸ‰ æ‰€æœ‰æµ‹è¯•è¿è¡Œå®Œæˆï¼ç‚¹å‡»"ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š"æŸ¥çœ‹è¯¦ç»†ç»“æœã€‚';
        }

        function generateReport() {
            const resultDiv = document.getElementById('overall-result');
            resultDiv.style.display = 'block';
            
            const totalTests = Object.keys(testResults).length;
            const passedTests = Object.values(testResults).filter(result => result === true).length;
            const failedTests = totalTests - passedTests;
            
            let report = `ğŸ“Š æµ‹è¯•æŠ¥å‘Š (${new Date().toLocaleString()})\n\n`;
            report += `æ€»æµ‹è¯•æ•°: ${totalTests}\n`;
            report += `é€šè¿‡: ${passedTests}\n`;
            report += `å¤±è´¥: ${failedTests}\n`;
            report += `æˆåŠŸç‡: ${totalTests > 0 ? ((passedTests / totalTests) * 100).toFixed(1) : 0}%\n\n`;
            
            report += `è¯¦ç»†ç»“æœ:\n`;
            Object.entries(testResults).forEach(([test, result]) => {
                report += `${result ? 'âœ…' : 'âŒ'} ${test}\n`;
            });
            
            report += `\nå»ºè®®:\n`;
            if (failedTests === 0) {
                report += `ğŸ‰ æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼åº”ç”¨åŠŸèƒ½æ­£å¸¸ã€‚`;
            } else {
                report += `âš ï¸ æœ‰ ${failedTests} é¡¹æµ‹è¯•å¤±è´¥ï¼Œå»ºè®®æ£€æŸ¥å¹¶ä¿®å¤ç›¸å…³é—®é¢˜ã€‚`;
            }

            resultDiv.className = `test-result ${failedTests === 0 ? 'success' : 'error'}`;
            resultDiv.textContent = report;
        }

        function updateStatus(category, status) {
            const statusElement = document.getElementById(`${category}-status`);
            statusElement.className = `test-status status-${status}`;
            statusElement.textContent = {
                'pending': 'ç­‰å¾…æµ‹è¯•',
                'running': 'æµ‹è¯•ä¸­...',
                'passed': 'é€šè¿‡',
                'failed': 'å¤±è´¥'
            }[status];
        }

        // é¡µé¢åŠ è½½æ—¶çš„åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            console.log('è‡ªåŠ¨åŒ–æµ‹è¯•å·¥å…·å·²åŠ è½½');
        });
    </script>
</body>
</html>